<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•ç‚¹èµåŠŸèƒ½</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .test-btn {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            border: 1px solid #ddd;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .test-btn.liked {
            background: #ff4b4b;
            color: white;
        }
        .info {
            margin: 20px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #333;
            color: #0f0;
            border-radius: 8px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ç‚¹èµåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="info">
        <p>æ–‡ç« ID: <span id="postId">1</span></p>
        <p>ç‚¹èµçŠ¶æ€: <span id="likeStatus">æœªç‚¹èµ</span></p>
        <p>ç‚¹èµæ•°: <span id="likeCount">0</span></p>
        <p>localStorageå†…å®¹: <span id="storage"></span></p>
    </div>
    
    <button id="likeBtn" class="test-btn">ğŸ‘ ç‚¹èµ</button>
    <button id="clearBtn" class="test-btn">æ¸…é™¤localStorage</button>
    <button id="reloadBtn" class="test-btn">é‡æ–°åŠ è½½</button>
    
    <div class="log" id="log">æ—¥å¿—è¾“å‡ºï¼š</div>

    <script type="module">
        // æ¨¡æ‹ŸAPIå‡½æ•°
        const getLikedPosts = () => {
            const liked = localStorage.getItem('likedPosts');
            return liked ? JSON.parse(liked) : [];
        };
        
        const saveLikedPosts = (posts) => {
            localStorage.setItem('likedPosts', JSON.stringify(posts));
        };
        
        const log = (msg) => {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `\n[${time}] ${msg}`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        };
        
        let postId = '1';
        let likes = 23;  // åˆå§‹ç‚¹èµæ•°
        let isLiked = false;
        
        const updateUI = () => {
            const likedPosts = getLikedPosts();
            isLiked = likedPosts.includes(postId);
            
            document.getElementById('likeStatus').textContent = isLiked ? 'å·²ç‚¹èµ â¤ï¸' : 'æœªç‚¹èµ ğŸ¤';
            document.getElementById('likeCount').textContent = likes;
            document.getElementById('storage').textContent = JSON.stringify(likedPosts);
            document.getElementById('likeBtn').className = isLiked ? 'test-btn liked' : 'test-btn';
            document.getElementById('likeBtn').innerHTML = isLiked ? 'â¤ï¸ å–æ¶ˆç‚¹èµ' : 'ğŸ‘ ç‚¹èµ';
        };
        
        const handleLike = () => {
            log('ç‚¹å‡»ç‚¹èµæŒ‰é’®');
            const likedPosts = getLikedPosts();
            const isCurrentlyLiked = likedPosts.includes(postId);
            
            if (isCurrentlyLiked) {
                // å–æ¶ˆç‚¹èµ
                const index = likedPosts.indexOf(postId);
                likedPosts.splice(index, 1);
                likes = Math.max(0, likes - 1);
                log(`å–æ¶ˆç‚¹èµï¼Œæ–°çš„ç‚¹èµæ•°: ${likes}`);
            } else {
                // æ·»åŠ ç‚¹èµ
                likedPosts.push(postId);
                likes = likes + 1;
                log(`æ·»åŠ ç‚¹èµï¼Œæ–°çš„ç‚¹èµæ•°: ${likes}`);
            }
            
            saveLikedPosts(likedPosts);
            log(`ä¿å­˜åˆ°localStorage: ${JSON.stringify(likedPosts)}`);
            updateUI();
        };
        
        const clearStorage = () => {
            localStorage.removeItem('likedPosts');
            log('æ¸…é™¤localStorage');
            likes = 23;  // é‡ç½®ä¸ºåˆå§‹å€¼
            updateUI();
        };
        
        const reload = () => {
            log('é‡æ–°åŠ è½½é¡µé¢çŠ¶æ€');
            updateUI();
        };
        
        // åˆå§‹åŒ–
        document.getElementById('likeBtn').addEventListener('click', handleLike);
        document.getElementById('clearBtn').addEventListener('click', clearStorage);
        document.getElementById('reloadBtn').addEventListener('click', reload);
        
        // åˆå§‹åŠ è½½
        log('é¡µé¢åˆå§‹åŒ–');
        updateUI();
    </script>
</body>
</html>
